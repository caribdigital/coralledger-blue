@namespace CoralLedger.Blue.Web.Client.Components

<div class="map-legend-panel" role="complementary" aria-label="@LegendTitle">
    <div class="legend-header">
        <h6>@LegendTitle</h6>
        @if (!string.IsNullOrEmpty(LegendDescription))
        {
            <p>@LegendDescription</p>
        }
    </div>

    <div class="legend-items">
        @foreach (var item in Items)
        {
            <div class="legend-row">
                <span class="@GetMarkerClass(item)" style="@GetMarkerStyle(item)" aria-hidden="true"></span>
                <span>@item.Label</span>
            </div>
        }
    </div>

    @if (SecondaryItems?.Any() == true)
    {
        <hr />
        <div class="legend-header">
            <h6>@SecondaryTitle</h6>
        </div>
        <div class="legend-items">
            @foreach (var item in SecondaryItems)
            {
                <div class="legend-row">
                    <span class="@GetMarkerClass(item)" style="@GetMarkerStyle(item, dotSize: 12)" aria-hidden="true"></span>
                    <span>@item.Label</span>
                </div>
            }
        </div>
    }
</div>

@code {
    [Parameter] public string LegendTitle { get; set; } = "Legend";
    [Parameter] public string? LegendDescription { get; set; }
    [Parameter] public string SecondaryTitle { get; set; } = "Events";
    [Parameter] public IEnumerable<MapLegendItem> Items { get; set; } = Enumerable.Empty<MapLegendItem>();
    [Parameter] public IEnumerable<MapLegendItem>? SecondaryItems { get; set; }

    private static string GetMarkerClass(MapLegendItem item) =>
        item.UseDot ? "legend-dot" : "legend-color";

    private static string GetMarkerStyle(MapLegendItem item, int dotSize = 16)
    {
        if (string.IsNullOrWhiteSpace(item.Color))
        {
            return string.Empty;
        }

        return item.UseDot
            ? $"background:{item.Color};width:{dotSize}px;height:{dotSize}px;"
            : $"background:{item.Color};";
    }
}
